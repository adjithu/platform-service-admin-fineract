/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'MPaira' at '7/7/17 1:26 PM' with Gradle 2.14
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/2.14/userguide/tutorial_java_projects.html
 */
buildscript {
	repositories {
		maven { url "$repoUrl" }
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:1.4.1.RELEASE")
		classpath("se.transmode.gradle:gradle-docker:1.2")
		classpath("org.owasp:dependency-check-gradle:1.4.5")
		classpath("com.netflix.nebula:gradle-ospackage-plugin:4.4.0")
		classpath("gradle.plugin.com.boxfuse.client:flyway-release:4.2.0")
	}
}

repositories {
	maven { url "$repoUrl" }
}

ext {
	linkHomepage = 'https://git.davinta.com/Davinta-1p/platform-service-groupmanagement'
	linkCi = 'http://52.66.121.23/jenkins/job/platform-service'
	linkIssue = 'https://git.davinta.com/Davinta-1p/platform-service-groupmanagement/issues'
	linkScmUrl = 'https://git.davinta.com/Davinta-1p/platform-service-groupmanagement'
	linkScmConnection = 'https://git.davinta.com/Davinta-1p/platform-service-groupmanagement.git'
	
	assertjVersion = '3.4.1'
	jacksonVersion = '2.6.7'
	junitVersion = '4.12'
	cucumberJavaVersion = '1.2.5'
	restitoVersion = '0.9.2'
	log4jVersion = '1.2.17'
	slf4jVersion = '1.7.21'
	springVersion = '4.3.3.RELEASE'
	springSecurityCoreVersion = '4.1.1.RELEASE' 
	neo4jDriverVersion = '2.0.5'
	swaggerVersion = '2.4.0'
	aspectjVersion = '1.5.4'
	platformBomBaseVersion = '1.1.0.RELEASE'

	platformFrameworkClientVersion = '1.3.0.BUILD-SNAPSHOT'

	platformMessagingGroupmanagementVersion = '1.3.0.RELEASE'
	platformMessagingFamilysurveyVersion =  '1.3.0.RELEASE'

	platformUtilI18nVersion = '1.1.0.RELEASE'
	platformUtilExceptionVersion = '1.1.0.RELEASE'
	platformUtilLoggingVersion = '1.1.0.RELEASE'
	platformUtilMessagingVersion =  '1.3.0.RELEASE'


	mysqlDriverVersion = '5.1.39'
	logstashLogbackEncoderVersion = '4.9'
	logBackClassicVersion = '1.2.2'
	logBackJaninoVersion = '3.0.7'
	sysOutOverSlf4j = '1.0.2'
    jasyptVersion = '1.9.2'
    jasyptSpringBootVersion = '1.2'
	
	idPrefix = 'service' 
}
configurations.all {
	exclude group: 'org.slf4j', module: 'log4j-over-slf4j'
	resolutionStrategy.eachDependency { DependencyResolveDetails details ->	
		if (details.requested.name == 'logback-classic' || details.requested.name == 'logback-core') {
                details.useVersion '1.2.2'
    	}
	}
	exclude group: 'log4j', module: 'log4j'
	exclude group: 'javax.servlet', module: 'servlet-api'
	resolutionStrategy.cacheChangingModulesFor 0, 'seconds'
 	resolutionStrategy.cacheDynamicVersionsFor 0, 'seconds'
}

// Apply the java plugin to add support for Java
apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'spring-boot'
apply plugin: 'docker'
apply plugin: 'application'
apply plugin: 'org.owasp.dependencycheck'
apply plugin: 'nebula.rpm'
apply plugin: "org.flywaydb.flyway"

description = 'Platform Service Groupmanagement'

// JVM Settings for Application Start Scripts
applicationDefaultJvmArgs = [ "-server", "-d64", "-Xms512m", "-Xmx768m", "-XX:MaxMetaspaceSize=512m", "-Dfile.encoding=UTF-8", "-XX:+UseG1GC", "-XX:MaxGCPauseMillis=200", "-verbose:gc", "-XX:+PrintGCDetails", "-XX:+PrintGCDateStamps", "-Xloggc:/appdata/logs/enrollment-service/enrollment-service-gc-%t.log", "-XX:+UseGCLogFileRotation", "-XX:NumberOfGCLogFiles=10", "-XX:GCLogFileSize=100m", "-XX:+HeapDumpOnOutOfMemoryError", "-XX:HeapDumpPath=/appdata/logs/enrollment-service/enrollment-service-heapdump-%t.hprof" ]

dependencyManagement {
	imports {
		mavenBom "org.springframework.cloud:spring-cloud-dependencies:Camden.SR4"
	}
}


dependencies {
	compile "uk.org.lidalia:sysout-over-slf4j:$sysOutOverSlf4j"
	compile "ch.qos.logback:logback-classic:$logBackClassicVersion"
   	compile "ch.qos.logback:logback-core:$logBackClassicVersion"
   	compile "org.codehaus.janino:janino:$logBackJaninoVersion"
	compile("net.logstash.logback:logstash-logback-encoder:$logstashLogbackEncoderVersion")
	
	// Pltaform BOM dependencies
compile ("com.platform.bom:platform-bom-base:$platformBomBaseVersion") {changing = true}

//Platform Messaging dependencies
	//compile ("com.platform.messaging:platform-messaging-groupmanagement:$platformMessagingGroupmanagementVersion") {changing = true}
	//compile ("com.platform.messaging:platform-messaging-familysurvey:$platformMessagingFamilysurveyVersion") {changing = true}
	compile project (':platform-messaging-admin-fineract')
	compile "javax.interceptor:javax.interceptor-api:1.2"

//Platform Util dependencies.
	compile "com.platform.util:platform-util-i18n:$platformUtilI18nVersion"
	compile ("com.platform.util:platform-util-exception:$platformUtilExceptionVersion") {changing = true}
	compile ("com.platform.util:platform-util-logging:$platformUtilLoggingVersion") {changing = true}
	compile ("com.platform.util:platform-util-messaging:$platformUtilMessagingVersion") {changing = true}
	
//Platform Integration dependencies.
	compile ("com.platform.framework:platform-rest-client:$platformFrameworkClientVersion") { changing = true }
	
//Platform framework dependencies.
//Spring dependencies
	compile("org.springframework.boot:spring-boot-starter-web")
    compile("org.springframework.boot:spring-boot-starter-actuator")
    compile("org.springframework.boot:spring-boot-starter-cache")
    compile("org.springframework.boot:spring-boot-starter-data-jpa")
    compile("org.springframework.cloud:spring-cloud-starter-sleuth")
    compile("org.springframework.cloud:spring-cloud-starter-zipkin")
   	compile "mysql:mysql-connector-java:$mysqlDriverVersion"
   	
//Swagger dependencies
    compile ("io.springfox:springfox-swagger2:$swaggerVersion")
	compile ("io.springfox:springfox-swagger-ui:$swaggerVersion")
	compile ("org.jasypt:jasypt:$jasyptVersion")
    compile ("com.github.ulisesbocchio:jasypt-spring-boot:$jasyptSpringBootVersion")
    
//Test case dependencies
	testCompile("org.springframework.boot:spring-boot-starter-test")
   	testCompile "org.springframework:spring-test:$springVersion"
   	testCompile "junit:junit:$junitVersion"
	testCompile("info.cukes:cucumber-core:$cucumberJavaVersion")
	testCompile("info.cukes:cucumber-java:$cucumberJavaVersion")
	testCompile("info.cukes:cucumber-junit:$cucumberJavaVersion")
	testCompile("info.cukes:cucumber-spring:$cucumberJavaVersion")
	testCompile("com.h2database:h2")
	testCompile("com.xebialabs.restito:restito:$restitoVersion")

}

//bootRepackage {
//	mainClass = 'com.davinta.aeus.service.groupmanagement.Application'
//}

//custom aeus distribution
apply from: "custom.distribution.gradle"

//windows bootrun fix
apply from: "windows.bootrun.gradle"
